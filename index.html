<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="reveal.js/dist/reset.css">
	<link rel="stylesheet" href="reveal.js/dist/reveal.css">
	<link rel="stylesheet" href="reveal.js/dist/theme/black.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<section>
					Nix Concepts:
				</section>
				<section>
					<h3>Lazy</h3>
					Expressions are only evaluated when their value is needed
					(used).
					<pre>
						<code data-trim data-noescape>
							let
							  a = abort "will never happen";
							  b = "hello";
							  c = "world";
							in b + c
						</code>
					</pre>
				</section>
				<section>
					<h3>Functional</h3>
					<div class="r-stack">
						<div class="fragment fade-in-then-out">
							Programming style based on mathematical functions. <br>
							Instead of writing a sequence of operations that should be
							executed. <br>
							You apply functions to input to generate ouput.
						</div>
						<pre class="fragment fade-in-then-out">
							<code data-trim data-noescape>
								names = ['Mary', 'Isla', 'Sam']

								# Procedural
								for i in range(len(names)):
								   names[i] = hash(names[i])

								# Functional
								names = map(hash, names)
							</code>
						</pre>
						<pre class="fragment fade-in-then-out">
							<code data-trim data-noescape>
								let
								  names = [ "Mary" "Isla" "Sam" ];
								in builtins.map (x: builtins.hashString "sha256" x)	names
							</code>
						</pre>
						<pre class="fragment fade-in-then-out">
							<code data-trim data-noescape>
								let
								  names = [ "Mary" "Isla" "Sam" ];
								in builtins.map (builtins.hashString "sha256") names
                                                                # With currying
							</code>
						</pre>
					</div>
				</section>
				<section>
					<h3>Pure</h3>
					A pure function is a function where the return value is only determined by its
					inputs. <br>
					In Nix, all build operations try to be as pure as possible to achieve
					reproducible builds. <br>
					<a href="https://r13y.com/" target="_blank"> Nix reproducibility statistics.</a>
				</section>
			</section>
			<section>
				<section>
					Nix Language
				</section>
				<section data-background-iframe="https://nixos.org/manual/nix/unstable/language/index.html"
					data-background-interactive>
				</section>
			</section>
			<section>
				<section>
					Nix Flakes
				</section>
				<section>
					<div>
						<b>Flakes</b> introduce a dependecy managing system that improves
						<b>reproducibility</b>
						and usability in the nix ecosystem.
					</div>
					<small class="fragment fade-in">Although it's still an experimental feature,
						flakes are widely used in
						the Nix
						community.
					</small>
				</section>
				<section>
					<h4>Top level attributes:</h4>
					<div class="fragment"><b>description</b> is a string describing the flake.</div>
					<div class="fragment"><b>inputs</b> is an attribute set of all the dependencies
						of the flake.</div>
					<div class="fragment"><b>outputs</b> is a function that takes an attribute set
						of all inputs, and outputs another attribute set.</div>
					<div class="fragment"><b>nixConfig</b>
						attribute set which reflect the values given to nix.conf.</div>
				</section>
				<section>
					<h4>Inputs</h4>
					<div class="r-stack">
						<pre class="fragment fade-in-then-out">
							<code data-trim>
								inputs.import-cargo = {
								  type = "github";
								  owner = "edolstra";
								  repo = "import-cargo";
								};
							</code>
						</pre>
						<pre class="fragment fade-in-then-out">
							<code data-trim>
								inputs.import-cargo.url = "github:edolstra/import-cargo";
							</code>
						</pre>
						<div class="fragment fade-in">
							<h4>Where is the reproducibility tho?</h4>
							<div class="fragment fade-in">
								The lock file!
							</div>
						</div>
					</div>
				</section>
				<section>
					<h4>Lock file</h4>
					<div class="r-stack">
						<div class="fragment fade-out">
							flake.nix are typically "unlocked", that's why we need the
							flake.lock file generated by nix.
						</div>
						<span class="fragment fade-in-then-out">
							The generated lock file contains a graph structure specifying the
							exact <b>version (commit)</b> and <b>hash</b> of the input.
							To ensure reproducibility.
						</span>
					</div>
				</section>
				<section>
					<pre>
						<code data-trim class="r-stretch">
                          "version": 7,
                          "root": "n1",
                          "nodes": {
                            "n1": {
                              "inputs": {
                                "nixpkgs": "n2",
                                "import-cargo": "n3",
                                "grcov": "n4"
                              }
                            },
                            "n2": {
                              "inputs": {},
                              "locked": {
                                "owner": "edolstra",
                                "repo": "nixpkgs",
                                "rev": "7f8d4b088e2df7fdb6b513bc2d6941f1d422a013",
                                "type": "github",
                                "lastModified": 1580555482,
                                "narHash": "sha256-OnpEWzNxF/AU4KlqBXM2s5PWvfI5/BS6xQrPvkF5tO8="
                              },
                              "original": {
                                "id": "nixpkgs",
                                "type": "indirect"
                              }
                            },
                            "n3": {
                              "inputs": {},
                              "locked": {
                                "owner": "edolstra",
                                "repo": "import-cargo",
                                "rev": "8abf7b3a8cbe1c8a885391f826357a74d382a422",
                                "type": "github",
                                "lastModified": 1567183309,
                                "narHash": "sha256-wIXWOpX9rRjK5NDsL6WzuuBJl2R0kUCnlpZUrASykSc="
                              },
                              "original": {
                                "owner": "edolstra",
                                "repo": "import-cargo",
                                "type": "github"
                              }
                            },
                            "n4": {
                              "inputs": {},
                              "locked": {
                                "owner": "mozilla",
                                "repo": "grcov",
                                "rev": "989a84bb29e95e392589c4e73c29189fd69a1d4e",
                                "type": "github",
                                "lastModified": 1580729070,
                                "narHash": "sha256-235uMxYlHxJ5y92EXZWAYEsEb6mm+b069GAd+BOIOxI="
                              },
                              "original": {
                                "owner": "mozilla",
                                "repo": "grcov",
                                "type": "github"
                              },
                              "flake": false
                            }
                          }
                        }
						</code>
					</pre>
				</section>
			</section>
                        <section>
			  Development environments: Demo
			</section>
                        <section>
			  Declaring your own package: Demo
			</section>
		</div>
	</div>

	<script src="reveal.js/dist/reveal.js"></script>
	<script src="reveal.js/plugin/notes/notes.js"></script>
	<script src="reveal.js/plugin/markdown/markdown.js"></script>
	<script src="reveal.js/plugin/highlight/highlight.js"></script>
	<script src="reveal.js/plugin/search/search.js"></script>
	<script src="reveal.js/plugin/math/math.js"></script>
	<script src="reveal.js/plugin/notes/notes.js"></script>
	<script src="reveal.js/plugin/zoom/zoom.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealSearch, RevealMath, RevealNotes, RevealZoom]
		});
	</script>
</body>

</html>
